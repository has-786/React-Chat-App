(this["webpackJsonpreact-project"]=this["webpackJsonpreact-project"]||[]).push([[15],{138:function(e,t,n){"use strict";var a=n(119),r=n(120);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=r(n(0)),o=(0,a(n(121)).default)(c.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=o},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));n(0);var a=n(113),r=n(236),c=n(237),o=n(355),s=n(238),i=n(138),l=n.n(i),d=n(380),u=n(8),p=n(2),m=Object(a.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function b(e){var t=m(),n=localStorage.getItem("token");return Object(p.jsx)("div",{className:t.root,children:Object(p.jsx)(r.a,{position:"static",children:Object(p.jsxs)(c.a,{children:[Object(p.jsx)(s.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",children:Object(p.jsx)(l.a,{onClick:function(){return e.history.goBack()}})}),e.dp?Object(p.jsx)(s.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",children:Object(p.jsx)(d.a,{src:u.a+"/uploads/".concat(e.dp,"/").concat(n),style:{backgroundColor:"lightgrey"}})}):null,Object(p.jsx)(o.a,{variant:"h6",className:t.title,children:e.name})]})})})}},321:function(e,t,n){},322:function(e,t,n){"use strict";var a=n(119),r=n(120);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=r(n(0)),o=(0,a(n(121)).default)(c.createElement("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"}),"CloudDownload");t.default=o},379:function(e,t,n){"use strict";n.r(t);var a,r=n(3),c=n(17),o=n(216),s=n.n(o),i=n(217),l=n(5),d=n(0),u=n(4),p=n(356),m=n(113),b=(n(281),n(141)),j=n.n(b),h=n(115),g=n(322),f=n.n(g),x=n(9),y=n.n(x),O=n(8),v=(n(321),n(169)),w=n(152),k=n.n(w),B=new TextDecoder,C=new TextEncoder,E=function(){var e=Object(i.a)(s.a.mark((function e(t,n,a,r,c){var o,i,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l.length>5&&void 0!==l[5]?l[5]:"AES-CBC",e.next=3,window.crypto.subtle.importKey("raw",C.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 3:return i=e.sent,e.next=6,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:C.encode(n),iterations:a,hash:c},i,{name:o,length:r},!1,["encrypt","decrypt"]);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),A=function(e,t,n){var a;console.log(e),a=e,e=Uint8Array.from(atob(a),(function(e){return e.charCodeAt(0)})),console.log(e);return console.log(n),console.log(t),Object(i.a)(s.a.mark((function a(){var r,c;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,E("my password",t,1e5,256,"SHA-256");case 2:return r=a.sent,a.next=5,window.crypto.subtle.decrypt({name:"AES-CBC",iv:n},r,e.slice(32));case 5:return c=a.sent,console.log(c),a.abrupt("return",B.decode(c));case 8:case"end":return a.stop()}}),a)})))()},I=new TextEncoder,S=function(){var e=Object(i.a)(s.a.mark((function e(t,n,r,c,o){var i,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l.length>5&&void 0!==l[5]?l[5]:"AES-CBC",e.next=3,window.crypto.subtle.importKey("raw",I.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 3:return a=e.sent,e.next=6,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:I.encode(n),iterations:r,hash:o},a,{name:i,length:c},!1,["encrypt","decrypt"]);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),N=function(e,t,n){return console.log("salt "+t+" iv "+n),console.log(e),e=I.encode(e),console.log(e),Object(i.a)(s.a.mark((function a(){var r,o,i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,S("my password",t,1e5,256,"SHA-256");case 2:return r=a.sent,a.next=5,window.crypto.subtle.encrypt({name:"AES-CBC",iv:n},r,e);case 5:return o=a.sent,console.log("Encrypted ".concat(o)),s=[].concat(Object(c.a)(t),Object(c.a)(n),Object(c.a)(new Uint8Array(o))),i=btoa(String.fromCharCode.apply(String,Object(c.a)(new Uint8Array(s)))),console.log("concatennated ".concat(i)),a.abrupt("return",i);case 10:case"end":return a.stop()}var s}),a)})))()},T=n(129),_=(n(128),n(2)),F=void 0;T.a.configure();var D="#23D0E0",H=Object(m.a)({root:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12},heading:{textAlign:"justifyContent"},footer:{float:"right"},paging:{margin:"auto",backgroundColor:"beige",color:"black",marginBottom:"10px"},messageBox:{display:"flex",width:"100%",flexWrap:"wrap",backgroundColor:D},main:{backgroundColor:D,height:"100%",paddingTop:"70px",width:"100%"},container:{width:"300px",margin:"auto",minHeight:"70vh",padding:"2px",borderRadius:"10px"},msgs:{width:"260px",marginBottom:"10px"},sendbox:{width:"100%"},download:{marginRight:"-15px",color:"white"}});t.default=function(e){var t,n,a=H(),o=Object(u.c)((function(e){return e.chatReducer})),m=Object(u.b)(),b=e.match.params.room,g=e.match.params.emails,x=e.roomName,w=e.dp;t=b!=x?"/personal/".concat(b,"/").concat(g):"/chat/".concat(b),n=b===x?new Audio("../incoming.mp3"):new Audio("../../incoming.mp3");var B=Object(d.useState)(""),C=Object(l.a)(B,2),E=C[0],I=C[1],S=Object(d.useState)(!1),D=Object(l.a)(S,2),U=(D[0],D[1],Object(d.useState)(2)),K=Object(l.a)(U,2),R=K[0],M=K[1],P=Object(d.useState)("block"),z=Object(l.a)(P,2),L=z[0],V=z[1],G=Object(d.useRef)(null),J=k()(O.a,{transports:["websocket","polling"]}),W=localStorage.getItem("token"),Y=y.a.create({baseURL:O.a,headers:{Authorization:"bearer ".concat(W)}}),q=Object(u.c)((function(e){return e.userReducer.email})),Q=Object(u.c)((function(e){return e.userReducer.name})),X=function(e,a,r){e.emit("create",b),e.emit("user-joined",a,b),e.on("receiveimg",(function(e){r===e.email&&(document.getElementById("loader").style.display="none",Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m({type:"add_chat",payload:{room:b,msg:e}}),setTimeout((function(){return window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"})}),500),G.current.focus();case 3:case"end":return t.stop()}}),t)})))())})),e.on("receive",(function(e){r!==e.email&&(m({type:"add_recent",payload:{room:b,roomName:x,link:t,dp:w}}),console.log("received"),Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.path){t.next=7;break}return e.salt=e.salt.split(","),e.iv=e.iv.split(","),e.salt=new Uint8Array(e.salt),e.iv=new Uint8Array(e.iv),t.next=7,A(e.message,e.salt,e.iv).then((function(t){e.message=t}));case 7:Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m({type:"add_chat",payload:{room:b,msg:e}}),e.path?setTimeout((function(){return window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"})}),500):window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"}),G.current.focus();case 3:case"end":return t.stop()}}),t)})))(),n.play();case 9:case"end":return t.stop()}}),t)})))())}))};function Z(e){return $.apply(this,arguments)}function $(){return($=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y.post("getMessages",{room:b,page:t}).then((function(e){var n=e.data;if(1==n.status){function a(){return(a=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=t){e.next=3;break}return e.next=3,Y.get("getUser").then((function(e){var t=e.data;m({type:"load_user",payload:t}),X(J,t.name,t.email)})).catch((function(e){return T.a.error(e)}));case 3:return e.next=5,Object(i.a)(s.a.mark((function e(){var t,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.msgs,a=s.a.mark((function e(n){var a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=t[n]).path){e.next=12;break}for(console.log("salt "+a.salt),console.log("iv "+a.iv),a.salt=a.salt.split(","),a.iv=a.iv.split(","),r=0;r<a.salt.length;r++)a.salt[r]=parseInt(a.salt[r]);for(c=0;c<a.iv.length;c++)a.iv[c]=parseInt(a.iv[c]);return a.salt=new Uint8Array(a.salt),a.iv=new Uint8Array(a.iv),e.next=12,A(a.message,a.salt,a.iv).then((function(e){a.message=e}));case 12:case"end":return e.stop()}}),e)})),r=0;case 3:if(!(r<t.length)){e.next=8;break}return e.delegateYield(a(r),"t0",5);case 5:r++,e.next=3;break;case 8:m({type:"load_chat",payload:{room:b,msgs:t}});case 9:case"end":return e.stop()}}),e)})))();case 5:1==t&&setTimeout((function(){return window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"})}),350),M((function(e){return e+1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.end?V("none"):V("block"),function(){a.apply(this,arguments)}()}})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(d.useEffect)((function(){return o[b]?X(J,Q,q):Z(1),function(){J.disconnect(),m({type:"delete_chat",payload:b})}}),[]);function ee(){return(ee=Object(i.a)(s.a.mark((function e(){var n,a,r,c,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("file-input").files[0],document.getElementById("file-input").value){e.next=3;break}return e.abrupt("return");case 3:document.getElementById("file-input").value="",document.getElementById("loader").style.display="block",a=(new Date).getHours(),r=(new Date).getMinutes(),a=0==parseInt(a/10)?"0"+a:a,r=0==parseInt(r/10)?"0"+r:r,c=a+":"+r,o=4,n.type.includes("image")?o=1:n.type.includes("video")?o=2:n.type.includes("audio")&&(o=3),(i=new FormData).append("file",n),Y.post("sendFile",i).then((function(e){1==e.data.status?(n&&(n.value=""),document.getElementById("loader").style.display="none",m({type:"add_chat",payload:{room:b,msg:{flag:o,email:q,room:b,name:Q,msg:null,path:n.name,time:c,roomName:x,link:t}}}),m({type:"add_recent",payload:{room:b,roomName:x,link:t,dp:w}}),J.emit("send",{flag:o,email:q,room:b,name:Q,msg:null,path:n.name,time:c,roomName:x,link:t,dp:w})):T.a.error("Something went wrong",{autoClose:1e3})})).catch((function(e){return T.a.error("Something went wrong",{autoClose:1e3})}));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(e){var t=document.createElement("a");t.href=e,t.click()},ne={marginLeft:"auto",backgroundColor:"#fffcb7",color:"black"};return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("div",{style:{position:"fixed",width:"100%"},children:[Object(_.jsx)(v.a,Object(r.a)({name:x,dp:w},e)),Object(_.jsx)("center",{children:Object(_.jsx)(h.a,{id:"loader",style:{marginTop:"100px",display:"none"}})})]}),Object(_.jsxs)("div",{class:a.main,children:[Object(_.jsx)("div",{class:a.container,id:"container",children:Object(_.jsxs)("div",{id:"messages",class:a.messageBox,children:[Object(_.jsx)(p.a,{elevation:3,className:a.paging,style:{display:L},onClick:Z.bind(F,R),children:Object(_.jsx)("button",{class:"btn btn-sm",s:!0,children:"Older Messages"})}),void 0!=o[b]?o[b].map((function(e,t){var n=q===e.email?ne:{};return Object(_.jsx)(p.a,{elevation:3,className:a.msgs,style:n,children:0==e.flag?Object(_.jsxs)("div",{style:{padding:"10px"},children:[b===x?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("b",{children:e.name}),Object(_.jsx)("br",{})]}):null,Object(_.jsx)("span",{children:e.message}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{style:{float:"right"},children:e.time})]}):1==e.flag?Object(_.jsxs)("div",{style:{padding:"10px"},children:[b===x?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("b",{children:e.name}),Object(_.jsx)("br",{})]}):null,Object(_.jsx)("span",{children:Object(_.jsx)("img",{src:"/uploads/".concat(e.path,"/").concat(W),height:"100%",width:"100%"})}),Object(_.jsxs)("span",{children:[e.path,"\xa0\xa0 ",Object(_.jsx)(f.a,{color:"primary",style:{float:"right"},onClick:te.bind(F,O.a+"/uploads/".concat(e.path,"/").concat(W))})]}),Object(_.jsx)("br",{}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{style:{float:"right"},children:e.time})]}):2==e.flag?Object(_.jsxs)("div",{style:{padding:"10px"},children:[b===x?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("b",{children:e.name}),Object(_.jsx)("br",{})]}):null,Object(_.jsxs)("video",{width:"100%",height:"100%",controls:!0,children:[Object(_.jsx)("source",{src:O.a+"/uploads/".concat(e.path,"/").concat(W),type:"video/mp4"}),Object(_.jsx)("source",{src:O.a+"/uploads/".concat(e.path,"/").concat(W),type:"video/wav"}),Object(_.jsx)("source",{src:O.a+"/uploads/".concat(e.path,"/").concat(W),type:"video/ogg"})]}),Object(_.jsxs)("span",{children:[e.path,"\xa0\xa0 ",Object(_.jsx)(f.a,{color:"primary",style:{float:"right"},onClick:te.bind(F,O.a+"/uploads/".concat(e.path,"/").concat(W))})]}),Object(_.jsx)("br",{}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{style:{float:"right"},children:e.time})]}):3==e.flag?Object(_.jsxs)("div",{style:{padding:"10px"},children:[b===x?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("b",{children:e.name}),Object(_.jsx)("br",{})]}):null,Object(_.jsxs)("audio",{controls:!0,children:[Object(_.jsx)("source",{src:O.a+"/uploads/".concat(e.path,"/").concat(W),type:"audio/ogg"}),Object(_.jsx)("source",{src:O.a+"/uploads/".concat(e.path,"/").concat(W),type:"audio/mpeg"})]}),Object(_.jsxs)("span",{children:[e.path,"\xa0\xa0 ",Object(_.jsx)(f.a,{color:"primary",style:{float:"right"},onClick:te.bind(F,O.a+"/uploads/".concat(e.path,"/").concat(W))})]}),Object(_.jsx)("br",{}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{style:{float:"right"},children:e.time})]}):Object(_.jsxs)("div",{style:{padding:"10px"},children:[b===x?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("b",{children:e.name}),Object(_.jsx)("br",{})]}):null,Object(_.jsxs)("span",{children:[" ",e.path,"\xa0\xa0 ",Object(_.jsx)(f.a,{color:"primary",style:{float:"right"},onClick:te.bind(F,O.a+"/uploads/".concat(e.path,"/").concat(W))})]}),Object(_.jsx)("br",{}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{style:{float:"right"},children:e.time})]})})})):null]})}),Object(_.jsxs)("center",{children:[Object(_.jsxs)("div",{class:a.sendbox,children:[Object(_.jsx)("input",{type:"text",ref:G,placeholder:"Type your message here",value:E,onChange:function(e){return I(e.target.value)},autoFocus:!0}),Object(_.jsx)("button",{className:"btn btn-primary",onClick:function(e,n,a){if(""!==a){var r=(new Date).getHours(),o=(new Date).getMinutes(),l=(r=0==parseInt(r/10)?"0"+r:r)+":"+(o=0==parseInt(o/10)?"0"+o:o),d=a;document.getElementById("loader").style.display="block";var u=window.crypto.getRandomValues(new Uint8Array(16)),p=window.crypto.getRandomValues(new Uint8Array(16));console.log(u,p),Object(i.a)(s.a.mark((function r(){return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,m({type:"add_chat",payload:{room:n,msg:{flag:0,email:q,room:n,name:e,message:a,time:l}}});case 2:m({type:"add_recent",payload:{room:n,roomName:x,link:t,dp:w}}),window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"}),G.current.focus();case 5:case"end":return r.stop()}}),r)})))(),N(d,u,p).then((function(a){console.log(a),u=Object(c.a)(u),p=Object(c.a)(p),u=u.join(","),p=p.join(","),J.emit("send",{flag:0,email:q,room:n,name:e,msg:a,path:null,salt:u,iv:p,time:l,roomName:x,link:t,dp:w}),document.getElementById("loader").style.display="none",console.log("sent"),I("")}))}}.bind(F,Q,b,E),children:"Send"})]}),Object(_.jsx)("br",{}),Object(_.jsxs)("div",{class:a.sendbox,children:[Object(_.jsx)("label",{for:"file-input",children:Object(_.jsx)(j.a,{style:{color:"blue",width:"80px",cursor:"pointer"}})}),Object(_.jsx)("input",{id:"file-input",type:"file",style:{display:"none"},onChange:function(e){}}),Object(_.jsx)("button",{className:"btn btn-sm btn-danger",onClick:function(){return ee.apply(this,arguments)}.bind(F),children:"Send"})]})]})]})]})}}}]);
//# sourceMappingURL=15.dc474106.chunk.js.map