(this["webpackJsonpreact-project"]=this["webpackJsonpreact-project"]||[]).push([[17],{133:function(e,t,n){"use strict";var a=n(119),r=n(120);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=r(n(0)),o=(0,a(n(121)).default)(c.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=o},156:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));n(0);var a=n(113),r=n(220),c=n(221),o=n(349),s=n(222),i=n(133),l=n.n(i),u=n(2),d=Object(a.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function p(e){var t=d();return Object(u.jsx)("div",{className:t.root,children:Object(u.jsx)(r.a,{position:"static",children:Object(u.jsxs)(c.a,{children:[Object(u.jsx)(s.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",children:Object(u.jsx)(l.a,{onClick:function(){return e.history.goBack()}})}),Object(u.jsx)(o.a,{variant:"h6",className:t.title,children:e.name})]})})})}},309:function(e,t,n){},377:function(e,t,n){"use strict";n.r(t);var a,r=n(3),c=n(17),o=n(206),s=n.n(o),i=n(207),l=n(5),u=n(0),d=n(4),p=n(351),m=n(113),b=n(262),h=n(263),g=n.n(h),f=n(115),j=n(8),x=n.n(j),y=n(9),v=(n(309),n(156)),w=n(142),O=n.n(w),k=new TextDecoder,B=new TextEncoder,C=function(){var e=Object(i.a)(s.a.mark((function e(t,n,a,r,c){var o,i,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l.length>5&&void 0!==l[5]?l[5]:"AES-CBC",e.next=3,window.crypto.subtle.importKey("raw",B.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 3:return i=e.sent,e.next=6,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:B.encode(n),iterations:a,hash:c},i,{name:o,length:r},!1,["encrypt","decrypt"]);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),E=function(e,t,n){var a;console.log(e),a=e,e=Uint8Array.from(atob(a),(function(e){return e.charCodeAt(0)})),console.log(e);return console.log(n),console.log(t),Object(i.a)(s.a.mark((function a(){var r,c;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,C("my password",t,1e5,256,"SHA-256");case 2:return r=a.sent,a.next=5,window.crypto.subtle.decrypt({name:"AES-CBC",iv:n},r,e.slice(32));case 5:return c=a.sent,console.log(c),a.abrupt("return",k.decode(c));case 8:case"end":return a.stop()}}),a)})))()},A=new TextEncoder,I=function(){var e=Object(i.a)(s.a.mark((function e(t,n,r,c,o){var i,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l.length>5&&void 0!==l[5]?l[5]:"AES-CBC",e.next=3,window.crypto.subtle.importKey("raw",A.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 3:return a=e.sent,e.next=6,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:A.encode(n),iterations:r,hash:o},a,{name:i,length:c},!1,["encrypt","decrypt"]);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),S=function(e,t,n){return console.log("salt "+t+" iv "+n),console.log(e),e=A.encode(e),console.log(e),Object(i.a)(s.a.mark((function a(){var r,o,i;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,I("my password",t,1e5,256,"SHA-256");case 2:return r=a.sent,a.next=5,window.crypto.subtle.encrypt({name:"AES-CBC",iv:n},r,e);case 5:return o=a.sent,console.log("Encrypted ".concat(o)),s=[].concat(Object(c.a)(t),Object(c.a)(n),Object(c.a)(new Uint8Array(o))),i=btoa(String.fromCharCode.apply(String,Object(c.a)(new Uint8Array(s)))),console.log("concatennated ".concat(i)),a.abrupt("return",i);case 10:case"end":return a.stop()}var s}),a)})))()},T=n(126),H=(n(125),n(2)),R=void 0;T.a.configure();var U="#23D0E0",D=Object(m.a)({root:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12},heading:{textAlign:"justifyContent"},footer:{float:"right"},paging:{margin:"auto",backgroundColor:"beige",color:"black",marginBottom:"10px"},messageBox:{display:"flex",width:"100%",flexWrap:"wrap",backgroundColor:U},main:{backgroundColor:U,height:"100%",paddingTop:"70px",width:"100%"},container:{width:"300px",margin:"auto",minHeight:"70vh",padding:"2px",borderRadius:"10px"},msgs:{width:"250px",marginBottom:"10px"},sendbox:{width:"100%"},download:{marginRight:"-15px",color:"white"}});t.default=function(e){var t,n=new Audio("../incoming.mp3"),a=D(),o=Object(d.c)((function(e){return e.chatReducer})),m=Object(d.b)(),h=e.match.params.room,j=e.match.params.emails,w=e.roomName;t=h!=w?"/personal/".concat(h,"/").concat(j):"/chat/".concat(h);var k=Object(u.useState)(""),B=Object(l.a)(k,2),C=B[0],A=B[1],I=Object(u.useState)(!1),U=Object(l.a)(I,2),N=(U[0],U[1],Object(u.useState)(2)),K=Object(l.a)(N,2),F=K[0],_=K[1],M=Object(u.useState)("block"),L=Object(l.a)(M,2),P=L[0],W=L[1],z=Object(u.useRef)(null),G=O()(y.a,{transports:["websocket","polling"]}),J=localStorage.getItem("token"),V=x.a.create({baseURL:y.a,headers:{Authorization:"bearer ".concat(J)}}),Y=Object(d.c)((function(e){return e.userReducer.email})),q=Object(d.c)((function(e){return e.userReducer.name})),Q=function(e,a,r){e.emit("create",h),e.emit("user-joined",a,h),e.on("receiveimg",(function(e){r===e.email&&(document.getElementById("loader").style.display="none",Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m({type:"add_chat",payload:{room:h,msg:e}}),setTimeout((function(){return window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"})}),500),z.current.focus();case 3:case"end":return t.stop()}}),t)})))())})),e.on("receive",(function(e){m({type:"add_recent",payload:{room:h,roomName:w,link:t}}),r!==e.email&&(console.log("received"),Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.path){t.next=7;break}return e.salt=e.salt.split(","),e.iv=e.iv.split(","),e.salt=new Uint8Array(e.salt),e.iv=new Uint8Array(e.iv),t.next=7,E(e.message,e.salt,e.iv).then((function(t){e.message=t}));case 7:Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m({type:"add_chat",payload:{room:h,msg:e}}),e.path?setTimeout((function(){return window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"})}),500):window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"}),z.current.focus();case 3:case"end":return t.stop()}}),t)})))(),n.play();case 9:case"end":return t.stop()}}),t)})))())}))};function X(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.post("getMessages",{room:h,page:t}).then((function(e){var n=e.data;if(1==n.status){function a(){return(a=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=t){e.next=3;break}return e.next=3,V.get("getUser").then((function(e){var t=e.data;m({type:"load_user",payload:t}),Q(G,t.name,t.email)})).catch((function(e){return T.a.error(e)}));case 3:return e.next=5,Object(i.a)(s.a.mark((function e(){var t,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.msgs,a=s.a.mark((function e(n){var a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=t[n]).path){e.next=12;break}for(console.log("salt "+a.salt),console.log("iv "+a.iv),a.salt=a.salt.split(","),a.iv=a.iv.split(","),r=0;r<a.salt.length;r++)a.salt[r]=parseInt(a.salt[r]);for(c=0;c<a.iv.length;c++)a.iv[c]=parseInt(a.iv[c]);return a.salt=new Uint8Array(a.salt),a.iv=new Uint8Array(a.iv),e.next=12,E(a.message,a.salt,a.iv).then((function(e){a.message=e}));case 12:case"end":return e.stop()}}),e)})),r=0;case 3:if(!(r<t.length)){e.next=8;break}return e.delegateYield(a(r),"t0",5);case 5:r++,e.next=3;break;case 8:m({type:"load_chat",payload:{room:h,msgs:t}});case 9:case"end":return e.stop()}}),e)})))();case 5:1==t&&setTimeout((function(){return window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"})}),350),_((function(e){return e+1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.end?W("none"):W("block"),function(){a.apply(this,arguments)}()}})).catch((function(e){}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(u.useEffect)((function(){return o[h]?Q(G,q,Y):X(1),function(){G.disconnect()}}),[]);function $(){return($=Object(i.a)(s.a.mark((function e(){var n,a,r,c,o,i,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("file-input").files[0],document.getElementById("file-input").value){e.next=3;break}return e.abrupt("return");case 3:if(document.getElementById("file-input").value="",document.getElementById("loader").style.display="block",a=(new Date).getHours(),r=(new Date).getMinutes(),a=0==parseInt(a/10)?"0"+a:a,r=0==parseInt(r/10)?"0"+r:r,c=a+":"+r,o=2,n.type.includes("image")&&(o=1),1!=o){e.next=17;break}i={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},Object(b.a)(n,i).then((function(e){G.emit("send",{flag:o,email:Y,room:h,name:q,path:n.name,img:e,time:c,roomName:w,link:t})})).catch((function(e){alert(e.message),console.log(e.message)})),e.next=22;break;case 17:return(l=new FileReader).readAsDataURL(n),e.next=21,function(){var e=l.result.replace(/^data:.+;base64,/,"");G.emit("send",{flag:o,email:Y,room:h,name:q,path:n.name,img:e,time:c})};case 21:l.onloadend=e.sent;case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee={marginLeft:"auto",backgroundColor:"#fffcb7",color:"black"};return Object(H.jsxs)(H.Fragment,{children:[Object(H.jsxs)("div",{style:{position:"fixed",width:"100%"},children:[Object(H.jsx)(v.a,Object(r.a)({name:w},e)),Object(H.jsx)("center",{children:Object(H.jsx)(f.a,{id:"loader",style:{marginTop:"100px",display:"none"}})})]}),Object(H.jsxs)("div",{class:a.main,children:[Object(H.jsx)("div",{class:a.container,id:"container",children:Object(H.jsxs)("div",{id:"messages",class:a.messageBox,children:[Object(H.jsx)(p.a,{elevation:3,className:a.paging,style:{display:P},onClick:X.bind(R,F),children:Object(H.jsx)("button",{class:"btn btn-sm",s:!0,children:"Older Messages"})}),void 0!=o[h]?o[h].map((function(e,t){var n=Y===e.email?ee:{};return Object(H.jsx)(p.a,{elevation:3,className:a.msgs,style:n,children:0==e.flag?Object(H.jsxs)("div",{style:{padding:"10px"},children:[h===w?Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("b",{children:e.name}),Object(H.jsx)("br",{})]}):null,Object(H.jsx)("span",{children:e.message}),Object(H.jsx)("br",{}),Object(H.jsx)("span",{style:{float:"right"},children:e.time})]}):1==e.flag?Object(H.jsxs)("div",{style:{padding:"10px"},children:[h===w?Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)("b",{children:e.name}),Object(H.jsx)("br",{})]}):null,Object(H.jsx)("span",{children:Object(H.jsx)("img",{src:"/uploads/".concat(e.path,"/").concat(J),height:"100%",width:"100%"})}),Object(H.jsx)("span",{style:{float:"right"},children:e.time})]}):Object(H.jsxs)("div",{style:{padding:"10px"},children:[Object(H.jsx)("b",{children:e.name}),Object(H.jsx)("br",{}),Object(H.jsxs)("video",{width:"100%",height:"100%",controls:!0,children:[Object(H.jsx)("source",{src:y.a+"/uploads/"+e.path,type:"video/mp4"}),Object(H.jsx)("source",{src:y.a+"/uploads/"+e.path,type:"video/ogg"})]}),Object(H.jsx)("span",{style:{float:"right"},children:e.time})]})})})):null]})}),Object(H.jsxs)("center",{children:[Object(H.jsxs)("div",{class:a.sendbox,children:[Object(H.jsx)("input",{type:"text",ref:z,placeholder:"Type your message here",value:C,onChange:function(e){return A(e.target.value)},autoFocus:!0}),Object(H.jsx)("button",{className:"btn btn-primary",onClick:function(e,n,a){if(""!==a){var r=(new Date).getHours(),o=(new Date).getMinutes(),l=(r=0==parseInt(r/10)?"0"+r:r)+":"+(o=0==parseInt(o/10)?"0"+o:o),u=a;document.getElementById("loader").style.display="block";var d=window.crypto.getRandomValues(new Uint8Array(16)),p=window.crypto.getRandomValues(new Uint8Array(16));console.log(d,p),Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m({type:"add_chat",payload:{room:n,msg:{flag:0,email:Y,room:n,name:e,message:a,time:l}}});case 2:window.scrollTo({top:document.getElementById("messages").scrollHeight,behaviour:"smooth"}),z.current.focus();case 4:case"end":return t.stop()}}),t)})))(),S(u,d,p).then((function(a){console.log(a),d=Object(c.a)(d),p=Object(c.a)(p),d=d.join(","),p=p.join(","),G.emit("send",{flag:0,email:Y,room:n,name:e,msg:a,salt:d,iv:p,time:l,roomName:w,link:t}),document.getElementById("loader").style.display="none",console.log("sent"),A("")}))}}.bind(R,q,h,C),children:"Send"})]}),Object(H.jsx)("br",{}),Object(H.jsxs)("div",{class:a.sendbox,children:[Object(H.jsx)("label",{for:"file-input",children:Object(H.jsx)(g.a,{style:{color:"blue",width:"80px",cursor:"pointer"}})}),Object(H.jsx)("input",{id:"file-input",type:"file",style:{display:"none"},onChange:function(e){}}),Object(H.jsx)("button",{className:"btn btn-sm btn-danger",onClick:function(){return $.apply(this,arguments)}.bind(R),children:"Send"})]})]})]})]})}}}]);
//# sourceMappingURL=17.7c282415.chunk.js.map